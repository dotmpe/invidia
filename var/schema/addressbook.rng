<?xml version="1.0" encoding="UTF-8"?>
<grammar xmlns="http://relaxng.org/ns/structure/1.0"
    datatypeLibrary="http://www.w3.org/2001/XMLSchema-datatypes">
  <!-- Expanded on example from tutorial -->
  <!-- http://www.relaxng.org/compact-tutorial-20030326.html -->
  <start><ref name="element addressBook {"/></start>
  <oneOrMore>
    <element name="card">
      <interleave>
        <element name="name">
          <text/>
        </element>
        <ref name="contactInfo"/>
      </interleave>
    </element>
  </oneOrMore>
  <define name="contactInfo">
    <choice>
      <element name="email">
        <text/>
      </element>
      <element name="telnr">
        <text/>
      </element>
      <ref name="address"/>
    </choice>
  </define>
  <define name="address">
    <choice>
      <choice>
        <interleave>
          <optional>
            <element name="housenr">
              <data type="integer"/>
            </element>
          </optional>
          <element name="street">
            <ref name="Text"/>
          </element>
          <element name="city">
            <ref name="Text"/>
          </element>
          <optional>
            <element name="state">
              <ref name="Text"/>
            </element>
          </optional>
          <element name="country">
            <ref name="Text"/>
          </element>
          <ref name="postageId"/>
        </interleave>
        <interleave>
          <optional>
            <element name="city">
              <ref name="Text"/>
            </element>
          </optional>
          <optional>
            <element name="state">
              <ref name="Text"/>
            </element>
          </optional>
          <element name="country">
            <ref name="Text"/>
          </element>
          <ref name="postageId"/>
        </interleave>
      </choice>
      <ref name="postageId"/>
    </choice>
  </define>
  <define name="Text">
    <data type="string"/>
  </define>
  <define name="postageId">
    <choice>
      <element name="zipcode">
        <text/>
      </element>
      <element name="postalcode">
        <data type="string"/>
      </element>
      <element name="postalbin">
        <text/>
      </element>
    </choice>
  </define>
</grammar>
